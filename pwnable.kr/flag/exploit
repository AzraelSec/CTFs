#!/usr/bin/python
from pwn import *

upx_present = yesno('Is there upx installed on this system?')
file_t = '/tmp/flag_bin'
flag_addr = 0x6c2070
start_addr = "0x401058"

if upx_present is True:
    wget('http://pwnable.kr/bin/flag', file_t)
    p = process(['chmod', '+x', file_t])
    log.info('File saved at %s'%(file_t))
    p.close()
    
    p = process(['upx', '-d', file_t])
    log.info('File %s decrypted with UPX'%(file_t))
    p.close()
    
    deb = gdb.debug(file_t, '''
    b *%s
    x/xs *%s
    continue
    '''%(start_addr, flag_addr))
    flag = deb.readall()

    log.success('Flag: %s'%flag)
else:
    log.failure('You need UPX ecrypter to execute this exploit')
